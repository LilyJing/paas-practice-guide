## 为什么需要“持续”

在敏捷开发的过程中，完成一次迭代的时间被缩短到一两个星期或者更短的时间，如果还是依赖原有人工的方式进行需求分配、代码开发、代码合并、单元测试、集成测试、代码集成、部署上线这样的流程未免太慢，无法达到“敏捷”的效果。于是自然而然的，软件开发的从业者们很快就找到了**通过软件自身来管理和加强软件开发效率的道路**。

一系列的辅助敏捷开发的自动化工具出现了，敏捷开发中的每一个过程可以被串接成流水线（Pipeline）的模式，尽量让软件开发的每个过程自动化。即使是诸如代码评审、上线审批等不得不引入人工参与的决策点，也尽量通过自动发送邮件、预先检查代码是否符合规范等方式进行一定程度的自动化辅助。

Jenkins就是这类自动化工具的典型代表，它是一个开源项目，提供了一种易于使用的持续集成系统，使开发者从繁杂的集成中解脱出来，专注于更为重要的业务逻辑实现上。同时 Jenkins 能实施监控集成中存在的错误，提供详细的日志文件和提醒功能，还能用图表的形式形象地展示项目构建的趋势和稳定性。Jenkins的开放性很好，可以通过各种插件扩展对各个环境的支持，比如代码库访问、通过Ant或者Maven编译、自动化测试、自动化部署到各种环境、发邮件等。通过Pipeline插件，可以在Jenkins的界面上清晰看到每一次自动化的集成中每一个步骤的执行情况。如下图所示：

![](/assets/46653-20160717150213607-1148676264.png)

原本“集成”和“上线”的环节是整个敏捷开发过程中最让人痛苦的部分，而通过这样的自动化工具定义了一些**可重复**的步骤之后，开发者进行敏捷开发的效率进一步提升，代码反应到生产系统中的时间缩短了。这遵循了计算机中一个不成文的规则，那就是：如果有什么事情是痛苦的，那么我们就持续不断地做它，这样就不痛苦了。因此这一系列的软件开发最佳实践被统一冠上了“**持续**”的名字。

在最佳的实践中，开发人员只需要将本地开发完成和测试好的代码推送到代码仓库，代码仓库会自动触发一系列预定义的代码格式检查、自动执行单元测试、自动发起代码评审的请求，等到代码评审完成后又会自动地部署到测试环境进行集成测试，通过集成测试后自动发起上线审批流程，待产品经理审批后进入自动化的预发布和正式上线流程。

通过这些提升软件开发效率的实践，Netflix甚至可以每天上线数百次之多，而且上线的质量是可以重复和有保障的。这已经超出了传统软件过程能力成熟度评估CMMI所规定的最高级别范畴。

## 定义：持续交付、持续集成和持续部署

维基百科上如此定义持续集成：

> **持续集成**（英语：Continuous integration，缩写为 CI），一种软件工程流程，将所有工程师对于软件的工作复本，每天集成数次到共用主线（mainline）上。这个名称最早由葛来迪·布区（Grady Booch）在他的布区方法中提出，但是他并没有提到要每天集成数次。之后成为极限编程（extreme programming，缩写为XP）的一部分。在测试驱动开发（TDD）的作法中，通常还会搭配自动单元测试。持续集成的提出，主要是为了解决软件进行系统集成时面临的各项问题，极限编程称这些问题为集成地狱（integration hell）。

因此我们说持续集成是一个工作流程来实现代码快速集成到主分支上，而软件工具的使用只是实现这一目的的手段，通过软件工具，我们可以更加保证时间、保证质量地进行集成工作。

而持续交付在维基百科上的描述如下：

> **持续交付**（英语：Continuous delivery，缩写为 CD），是一种软件工程手法，让软件产品的产出过程在一个短周期内完成，以保证软件可以稳定、持续的保持在随时可以释出的状况。它的目标在于让软件的构建、测试与发布变得更快以及更频繁。这种方式可以减少软件开发的成本与时间，减少风险。

所以，**持续交付**涵盖了从需求到最终上线的全流程，而**持续集成**则涵盖了从"需求"开发为“代码”，然后编译和打包成“制品”的过程。为了方便的描述，我们将从“制品”运行成“服务”的过程称之为**持续部署**。

```
插图：需求-》代码-》制品-》运行的服务 。广义的持续交付涵盖全部，持续集成覆盖了从需求到代码的部分。持续部署则仅覆盖后面一部分。
```

## 原有持续集成和持续交付实现方式

持续集成和持续交付作为支持敏捷开发的方法论很早就被投入了软件工程的实践，一些工具软件应允而生来增强开发团队的效率。

要实现持续集成和持续交付，首要必须对项目进行很好的管理。与瀑布式的开发模式不一样，敏捷开发需要大量迭代，因此必须要很好的项目管理手段，这些管理手段需要能直观，而且能很好的协作。看板就是一种很好的方式，很多企业自己开发了看版的应用，另外类似Teambition、Tower的SaaS化看板服务也迎合了很多创业团队的需求。如果要自己搭建，则可以利用Redmine之类的开源软件来定制化自己的看板需求。

代码管理非常重要。因为持续集成和持续交付意味着大量的代码协作，甚至还有包括一系列的跨团队代码协作和跨地域的代码协作。比如：一些创业公司的团队可能分布在世界各地，而一些大型企业的代码中会包含其他团队的组件。当前最适合的代码管理工具非git莫属，但是git是命令行的，缺少流程管理和审批等，因此一些团队直接使用github.com提供的SaaS代码管理服务，一些团队则自己搭建基于gitlab开源软件的代码管理服务。使用SaaS的github有利于推进企业软件的开源，让更多的外部开发者能参与代码的修改和review，而使用gitlab的好处在于代码的安全性可以更好管理，也能避免pull代码时候的网络延时。

除了代码本身的管理外，如何保证各个代码分支之间和合并流程也是需要在代码管理中要解决的，这通常意味着代码审查（Code Review）和代码合并（Merge）。在github.com中，我们通常可以通过fork代码到自己的项目中，修改，然后提交Pull Request的方式发起对一段代码的变更；然后代码的维护者可以进行评审，这种代码评审可以是人工的，也可以通过github.com的生态链上其他工具来进行，通过后就Merge这段代码。如果自己搭建，则可以使用Gerrit，它一种免费、开源的代码审查软件。

一个正规化和工程化做得比较好的软件企业，一定有严格的代码质量管控流程，其中最先要实现的就是对代码格式的检查。因此代码格式保持规范化有助于降低其他人阅读代码的难度，以便使用、修复或后续开发。比如Kubernetes，由于一开始就做了比较好的代码约定，并通过后续的代码评审环节严格保障，所以整个代码就像一个人写的一样，让人易懂且赏心悦目。代码格式检查涉及的规则众多，一般不可能仅通过人工来完成，所以比较好的做法是通过工具来实现自动化。每种语言都有自己的代码格式检查工具，比如Java的Checkstyle、JavaScript的JSCS。在持续集成中可以充分利用这些代码检查工具，建立企业级的代码规则库。

完成代码格式的检查后，接下来最重要的就是代码质量的检查，在持续集成中我们需要通过自动化的测试手段来实现。一般来说，软件质量的测试可以分为：单元测试、集成测试、性能测试、可用性测试和验收测试。

* 单元测试的自动化框架已经非常成熟，通常开发人员自己就应该在本地就成功完成了单元测试，在持续集中中进行单元测试的自动化的目的是为了验证这一过程，并打回不通过的代码提交。

* 集成测试是实现了实现多个应用之间交互，或者与数据库等组件进行交互时候必要进行的一个过程。同样我们可以使用一些自动化的工具或者自己写一些脚本来完成这一过程。

* 性能测试的自动化工具很多，通过工具自己的脚本语言或者通过其他语言调用工具的接口来使得这些工具自动化。

* 可用性和验收测试需要较多的条件，一般难以实现自动化，通过人工的方式进行。

完成代码质量的测试之后，一般会经过人工审查的过程，有一些自动化的流程可以提醒相关人参与审批。经过这一系列的审批以后，这些代码就应该被按照顺序部署在预上线环境或者生产环境中了。如果要能实现快速、持续的交付，这个步骤也需要自动化。
Jenkins是一个持续集成和持续部署过程中非常有代表性的工具，它可以将上述流程串接为Pipepline的形式，既方便修改流程，也能实现非常好的可视化。

## 持续集成和持续交付是PaaS必须提供的能力

**持续集成和持续交付与PaaS是相互促进的关系**。

如第四章所介绍，持续集成和持续交付本来就是PaaS云平台提供的一项面向开发者的服务。PaaS云平台不但需要提供托管开发者提交代码的运行时环境、提供满足开发者服务水平（SLA）需求的后端支持服务，还需要提供一系列的开发工具来作为配套措施，提升开发者的效率。

比如IBM的Bluemix，是一个基于Cloud Foundry提供的公有云PaaS平台，提供了众多的运行时环境和后端支持服务，IBM将其开发效率工具Rational整合了进来，不但包括代码协作，还包括了持续集成和部署的流水线。

```
截图 IBM的持续集成。
```

持续集成和持续交付的工具是PaaS的能力倍增器，已经成为成功的PaaS平台不可缺少的一项服务。特别是在Docker出现后大大降低了交付过程中可能出现的不一致性，更是推广了持续集成和持续交付的应用规模。

## **PaaS反过来促进了持续集成和持续交付在开发者中的普及**

由于持续集成和持续交付需要大量在软件开发中的实践经验总结才能实现，这些平台的搭建还需要综合利用多种开源工具，比如Gitlab做代码库、Gitrret做代码评审、Jenkins串接自动化流程、各种单元测试框架。中小软件企业或个人开发者很难享受这样的便利性，只有大型软件企业例如百度和阿里巴巴，通过成立一个工程效率部的形式来面向公司内部提供提供这样的技术手段。

但有了PaaS就不一样了，这些沉淀的最佳实践可以飞入寻常百姓家。即使是个人开发者在开发自己的项目的时候也可以享受媲美一流软件企业的工程效率服务。由于PaaS平台面向各开发者提供这些能力，自身很容易实现规模效益，从而将这些工程效率的最佳实践实现得更加充分，这又是云计算实现了分工，促进两方更加专业，提升整体效率的又一例证。

为什么，有什么意义和作用

定义是什么

原来是怎么做的，有什么工具

和PaaS的关系是什么

有了PaaS后这个事情变成了什么，PaaS提供他以后带来了什么便利，对PaaS有什么新价值

