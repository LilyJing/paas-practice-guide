## 什么是微服务

**微服务** \(Micro services\) 是一种软件架构风格 \(Software Architecture Style\)，它是以专注于单一责任与功能的小型功能区块 \(Small Building Blocks\) 为基础，利用模组化的方式组合出复杂的大型应用程序，各功能区块使用与语言无关 \(Language-Independent\/Language agnostic\) 的 API 集相互通讯。

微服务是以业务功能为主进行设计，每一个微服务都具有自主运行的业务功能，对外开放不受语言限制的 API \(最常用的是 HTTP协议的Rest API\)，应用程序则是由一个或多个微服务组成。相对于微服务的是**单体式 \(Monolithic\)** 应用程序，单体式应用表示一个应用程序内包含了所有需要的业务功能。

## **微服务架构的益处**

首先，通过分解巨大**单体式 \(Monolithic\)** 应用为多个服务的方法解决了复杂性问题。“大事划小”这是我们处理复杂事物的一贯原则，只要能不断的切分，任何复杂事物最后会变成简单的“分子”、“原子”的各种叠加。分解后的每个可管理的微服务都有一个清晰定义的边界，通过RPC或者消息API的方式对外服务。微服务架构使得复杂的单体式应用变成模块化，从而降低了开发和维护的难度。

其次，这种架构使得每个服务都可以有专门开发团队来开发。开发者可以自由选择开发技术，提供API服务。当然，许多公司试图避免混乱，只提供某些技术选择。然后，这种自由意味着开发者不需要被迫使用某项目开始时采用的过时技术，他们可以选择现在的技术。甚至于，因为服务都是相对简单，即使用现在技术重写以前代码也不是很困难的事情。

在此，微服务架构模式是每个微服务独立的部署。开发者不再需要协调其它服务部署对本服务的影响。这种改变可以加快部署速度。UI团队可以采用AB测试，快速的部署变化。微服务架构模式使得持续化部署成为可能。

最后，微服务架构模式使得每个服务独立扩展。你可以根据每个服务的规模来部署满足需求的规模。甚至于，你可以使用更适合于服务资源需求的硬件。比如，你可以在EC2 Compute Optimized instances上部署CPU敏感的服务，而在EC2 memory-optimized instances上部署内存数据库。

## **微服务架构的不足**

Fred Brooks在30年前写道，“there are no silver bullets”，像任何其它科技一样，微服务架构也有不足。其中一个跟他的名字类似，『微服务』强调了服务大小，实际上，有一些开发者鼓吹建立稍微大一些的，10-100 LOC服务组。尽管小服务更乐于被采用，但是不要忘了这只是终端的选择而不是最终的目的。微服务的目的是有效的拆分应用，实现敏捷开发和部署。

另外一个主要的不足是，微服务应用是分布式系统，由此会带来固有的复杂性。开发者需要在RPC或者消息传递之间选择并完成进程间通讯机制。更甚于，他们必须写代码来处理消息传递中速度过慢或者不可用等局部失效问题。当然这并不是什么难事，但相对于单体式应用中通过语言层级的方法或者进程调用，微服务下这种技术显得更复杂一些。

另外一个关于微服务的挑战来自于分区的数据库架构。商业交易中同时给多个业务分主体更新消息很普遍。这种交易对于单体式应用来说很容易，因为只有一个数据库。在微服务架构应用中，需要更新不同服务所使用的不同的数据库。使用分布式交易并不一定是好的选择，不仅仅是因为CAP理论，还因为今天高扩展性的NoSQL数据库和消息传递中间件并不支持这一需求。最终你不得不使用一个最终一致性的方法，从而对开发者提出了更高的要求和挑战。

测试一个基于微服务架构的应用也是很复杂的任务。比如，采用流行的Spring Boot架构，对一个单体式web应用，测试它的REST API，是很容易的事情。反过来，同样的服务测试需要启动和它有关的所有服务（至少需要这些服务的stubs）。再重申一次，不能低估了采用微服务架构带来的复杂性。

另外一个挑战在于，微服务架构模式应用的改变将会波及多个服务。比如，假设你在完成一个案例，需要修改服务A、B、C，而A依赖B，B依赖C。在单体式应用中，你只需要改变相关模块，整合变化，部署就好了。对比之下，微服务架构模式就需要考虑相关改变对不同服务的影响。比如，你需要更新服务C，然后是B，最后才是A，幸运的是，许多改变一般只影响一个服务，而需要协调多服务的改变很少。

部署一个微服务应用也很复杂，一个分布式应用只需要简单在复杂均衡器后面部署各自的服务器就好了。每个应用实例是需要配置诸如数据库和消息中间件等基础服务。相对比，一个微服务应用一般由大批服务构成。例如，根据Adrian Cockcroft，[Hailo有160个不同服务构成](https://sudo.hailoapp.com/services/2015/03/09/journey-into-a-microservice-world-part-3/)，NetFlix有大约600个服务。每个服务都有多个实例。这就造成许多需要配置、部署、扩展和监控的部分，除此之外，你还需要完成一个服务发现机制（后续文章中发表），以用来发现与它通讯服务的地址（包括服务器地址和端口）。传统的解决问题办法不能用于解决这么复杂的问题。接续而来，成功部署一个微服务应用需要开发者有足够的控制部署方法，并高度自动化。

## 微服务架构的实现方式

## 微服务架构与PaaS

微服务架构带来了开发效率和运行效率的提升，但如果缺少适当的工具就会有很高的运维成本，Docker改变了这一切。开发者可以不用使用Spring Cloud或Dubbo这样的Java语言级框架；并且Docker接管了资源控制、安全隔离、网络可达、日志、运行监控、健康检查等复杂、琐碎且重复的事宜。Docker降低了我们应用微服务的难度，使得架构师可以将功能拆小，小意味着简单、可扩展性强、可靠性高、可以自由组合。

如果只是几台机器的小规模部署系统，仅用Docker在传统工具下自动部署就可以，但是一个大型的、多租户的系统，还是需要一个完善的容器编排框架，并将所有容器难以承担的有状态后端服务进行管理，那就是PaaS。PaaS使得微服务的部署不用关心物理集群、可以跨集群进行访问、微服务可以形成组合并有效隔离、集中收集日志、维持全局微服务状态，PaaS还提供了服务注册和发现的框架，使得应用不需要自己实现。当然PaaS还集中管理了持久化卷以及诸如Mysql之类的Backing Service，使得微服务的开发和运维工作进一步简化。

所以说PaaS云平台的形式使得更多的开发者可以负担得起微服务的架构。

