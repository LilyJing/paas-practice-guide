## 为什么需要DevOps

很多组织将开发和和系统管理划分成不同的部门。开发部门的驱动力通常是“频繁交付新特性”，而运营部门则更关注IT服务的可靠性和IT成本投入的效率。两者目标的不匹配，就在开发与运营部门之间造成了鸿沟，从而减慢了IT交付业务价值的速度。敏捷开发加剧了Dev和Ops之间的矛盾，原本需要排期的上线工作编程了每周定期进行，问题变得更加严重。

![](/assets/why_devops.jpg)

为了应对敏捷开发带来的变化，业界逐渐找到了自己的解决方案，那就是DevOps，开发运维一体化。它的核心理念是让运维工作尽量自动化，并让开发人员更多地控制生产环境。在这种指导思想下，传统的运维人员需要改变以往手工运维的模式，尽量开发出来自动化的工具，一是使得系统更加健壮，遇到问题可以自愈；二是将运维手段提供给开发人员，让其自助。因此一类新的职业开始出现在招聘网站上，叫做“运维开发”。

## 什么是DevOps

维基百科上DevOps定义如下：

> **DevOps**（Development和Operations的组合词）是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化、运动或惯例。透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。

因此DevOps是一种文化、运动或者惯例，目的是促进开发和运维两个体系的有机结合，既提高系统运维水平，又能保障敏捷开发和快速迭代的实施。如下图所示：

![](/assets/what_devops.jpg)

## DevOps的实现方式

作为一种支持敏捷开发的文化，DevOps的实践者们开发了一整套的体系来使得维护工作自动化、工具化。

首先要满足的功能就是自动化部署。在这一方面很多运维开发工程师已经拥有了强有力的工具，他们可以按照自己的技能熟悉程度来使用Puppet、Chef 、Ansible和Terraform。通过编写和共享这些工具所支持的脚本语言，运维工程师可以将原来手工之行的机器的安装配置、依赖软件的安装、应用软件的安装和配置等全部自动化。这种自动化的实现提供了一个契机，那就是将这些写好的自动化功能提供给开发者，这样开发者在完成开发之后就可以“自助”地让他们的软件上线。

其次在DevOps中要满足的功能就是自动化监控。Zabbix和OpenFalcon就是很好的能支持自动化监控的框架，可以在其中定义各种监控插件、定义事件、定义告警级别和流程等。自动化监控使得运维工程师7\*24小时能随时掌握系统情况，及时解决问题，提升系统的稳定性。同样，自动化监控工具的实现也可以将其中“应用级监控”的功能提供给应用开发者，让他们“自助”地监控自己的应用。

随着互联网和移动互联网的发展，用户体验变得越来越重要。原来从应用方面的监控逐步过渡到从客户体验角度上的监控。应用性能管理APM（Application Performance Monitor）强调从客户端、网络、反向代理、应用服务器、数据库等各个环节收集数据，然后汇总分析，并将从用户体验的角度将这些信息纳入管理。通常APM工具都会通过SDK或者Rest API的方式来让应用开发者直接使用，侵入型不强，但能给应用开发者提供其应用的360度视图，做到心中有数。APM也是DevOps工具中的一种。

再次需要实现的就是日志的统一收集。因为应用开发者并不关心运行的时候应用的实例会有多少个。这些实例可能运行在不通的地方，错误的日志当然也可能产生在不通的地方。运维工程师需要提供一个工具，来将这些日志准确地采集起来，并能进行预处理、格式化和可视化的展示。通常我们通过Elasticsearch+Logstash+Kibana来实现，或者通过Elasticsearch+Flume+Kibana来实现。然后按照规则将日志提供给应用开发者查看。

当然，如果要实现DevOps全流程，光有自动化部署和自动化监控是不足够的。因为程序的运行总有可能出现非预期的情况，而在开发环境中可能很难以捕捉到这些情况的发生，这也就需要运维工程师需要提供给应用开发者一个能在线上检查日志和调试的环境。这是整个DevOps最难的地方。因为区别于自动化部署和自动化监控，进入生产环节进行调试是运维工程师难以控制的行为。

如果部署是基于虚拟机的，可以授权应用开发者能远程SSH到这个机器，然后通过操作系统进行调试，这满足了应用开发者的需求，但可能会让运维人员赶到不愉快。因为这种方式下应用开发者可能破坏了这台虚拟机上的环境，可能改变了依赖软件的版本，也可能安装了一些可能引起安全问题的软件。而且运维人员很难将这个环境推到重来，因为开发者已经将他的软件在上面“手工”调试好了，再一次自动部署不一定能成功。

Docker的出现给了应用开发者和运维人员一个很好的界面，因为Docker的镜像是强制可以重复的，而Docker的容器则是假定不安全，随时都需要推倒的。Docker本身也提供了进入容器进行调试的方法，比如Docker exec，这种使用体验和应用开发者在本地调试是一样的。

谈到DevOps，必须有一个概念需要描述，那就是ChatOps。因为DevOps文化是为了保证Dev和Ops之间的顺畅沟通，因此保持一个良好的沟通渠道是必然的。原有通过邮件、OA、开发管理平台来进行沟通的方式肯定效率低、有障碍，而且这种方式还比较难以将上述工具集成进来。所以为了推进DevOps的实施，一大波改善沟通的工具出现了。以Slack举例，一个公司的IT人员按照职责、部门可以在其中建立不同的Channel，公司所使用的所有工具都可以方便地集成进Slack，比如有人推送代码了、代码持续集成失败了、运行中有告警、某人更新了看板等等。这种方式改善了沟通，让大家聊天的形式就把工作推进了。这种方式被称之为ChatOps。

## DevOps与PaaS

PaaS的出现简化了DevOps的实现。PaaS云平台天然就提供了Dev和Ops的分工界面，其实现的分工就是开发者和运维人员的分工。最早出现的PaaS 是公有云的PaaS，比如GAE和Heroku，在这种情况下开发者和平台运维人员根本不是属于一个公司的，也无法见面，甚至没有邮件和电话的沟通，因此必须通过开发人员自助进行代码部署、查看运行情况、查看日志，这是最完美的一种DevOps。

从公有云PaaS到私有云PaaS，面向开发者提供良好DevOps体验的功能被继承了下来。

为了给开发者提供良好的客户体验，提供的DevOps工具必须是完整的，而且贴近开发者在本地开发测试的方式，通常至少包括如下功能：

* 编译和运行。
* 调试。
* 查看运行日志。
* 登陆到运行环境的操作系统。
* 查看性能情况。
* 设置运行策略。

在Docker之前的PaaS云平台由于难以提供一个非常便利的调试环境而使得DevOps并不能有效实现。Docker的出现改变了这个现状，它提供了一个一致的环境让开发者可以进行本地的开发测试，而且可以远程登录到该容器之中查看运行状态。

为什么，有什么意义和作用

定义是什么

原来是怎么做的，有什么工具

和PaaS的关系是什么

有了PaaS后这个事情变成了什么，PaaS提供他以后带来了什么便利，对PaaS有什么新价值

